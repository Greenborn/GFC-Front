<div [ngClass]="responsiveService.isDesktop ? 'ion-page' : ''">
  <ion-header>
    <ion-toolbar>
      <ion-row class="ion-align-items-center ion-margin-end ion-margin-start">
        <ion-col>
          <h5 class="ion-text-wrap" *ngIf="!detalle?.items">
            {{ detalle?.contest?.name }}
          </h5>
          <h5 class="ion-text-wrap" *ngIf="detalle?.items">
            Detalle de ranking - Año {{ detalle?.year }}
          </h5>
        </ion-col>
        <ion-col size="1" class="ion-hide-md-down">
          <ion-button (click)="modalController.dismiss()" fill="clear" class="">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-toolbar>
  </ion-header>

  <div slot="start" class="w-100 inner-content ion-float-md-start">
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-row class="ion-align-items-center ion-justify-content-between">
            <ion-col>
              <ion-card-subtitle *ngIf="!detalle?.items">
                {{ formatDate(detalle?.contest?.start_date) }} -
                {{ formatDate(detalle?.contest?.end_date) }}
              </ion-card-subtitle>
              <ion-card-subtitle *ngIf="detalle?.items">
                Año: {{ detalle?.year }}
              </ion-card-subtitle>
            </ion-col>
            <ion-col size="auto">
              
            </ion-col>
          </ion-row>

          <ion-card class="ion-margin-top">
            <ion-card-header>
              <ion-card-title>Participante</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-row class="ion-align-items-center">
                <ion-col size="2" class="ion-hide-sm-down">
                  <app-usuario-img [src]="detalle?.profile?.img_url ? configService.imageUrl(detalle?.profile?.img_url) : ''"></app-usuario-img>
                </ion-col>
                <ion-col>
                  <ion-text>
                    <b>{{ detalle?.profile?.name }} {{ detalle?.profile?.last_name }}</b>
                  </ion-text>
                  <div>
                    {{ detalle?.profile?.fotoclub?.name }}
                  </div>
                </ion-col>
              </ion-row>
              <ion-row class="ion-margin-top">
                <ion-col></ion-col>
              </ion-row>
              
          </ion-card-content>
          </ion-card>

          <ion-card class="ion-margin-top ion-margin-bottom">
            <ion-card-header>
              <ion-card-title>Sumatoria de puntajes</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-row>
                <ion-col size="6">
                  <b>Total general:</b>
                  <span class="ion-margin-start">{{ totalScoreAll() }}</span>
                </ion-col>
                <ion-col size="6" *ngIf="detalle?.items">
                  <b>Concursos contabilizados:</b>
                  <span class="ion-margin-start">{{ detalle.items.length }}</span>
                </ion-col>
              </ion-row>
            </ion-card-content>
          </ion-card>

          <ng-container *ngIf="!detalle?.items; else multiple">
            <ion-card class="ion-margin-top">
              <ion-card-header>
                <ion-card-title>Resultados</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-list>
                  <ion-item color="dark">
                    <ion-grid>
                      <ion-row>
                        <ion-col size="3">Categoría</ion-col>
                        <ion-col size="3">Sección</ion-col>
                        <ion-col size="2">Miniatura</ion-col>
                        <ion-col size="2">Obra</ion-col>
                        <ion-col size="2">Métrica</ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item>
                  <ng-container *ngFor="let r of sortResults(detalle?.results)">
                    <ion-item *ngFor="let img of sortImages(r.images)">
                      <ion-grid>
                        <ion-row class="ion-align-items-center">
                          <ion-col size="3">{{ r.category }}</ion-col>
                          <ion-col size="3">{{ r.section }}</ion-col>
                          <ion-col size="2">
                            <img [src]="img?.thumbnail_url ? configService.imageUrl(img.thumbnail_url) : ''" alt="" style="height:48px;width:auto;border-radius:4px;" />
                          </ion-col>
                          <ion-col size="2" class="cap">{{ img.title }}</ion-col>
                          <ion-col size="2">
                            <ion-badge>{{ img.metric?.prize }}</ion-badge>
                            <span class="ion-margin-start">{{ img.metric?.score }}</span>
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                    </ion-item>
                  </ng-container>
                </ion-list>
              </ion-card-content>
            </ion-card>

            <ion-card class="ion-margin-top ion-margin-bottom">
              <ion-card-header>
                <ion-card-title>Ranking</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-row>
                  <ion-col size="6">
                    <b>Puntaje total:</b>
                    <span class="ion-margin-start">{{ detalle?.ranking?.total_score }}</span>
                  </ion-col>
                  <ion-col size="6">
                    <b>Posición:</b>
                    <span class="ion-margin-start">{{ detalle?.ranking?.position }}</span>
                  </ion-col>
                </ion-row>
              </ion-card-content>
            </ion-card>
          </ng-container>

          <ng-template #multiple>
            <ng-container *ngFor="let it of detalle.items">
              <ion-card class="ion-margin-top">
                <ion-card-header>
                  <ion-card-title>{{ it?.contest?.name }}</ion-card-title>
                  <ion-card-subtitle>
                    {{ formatDate(it?.contest?.start_date) }} - {{ formatDate(it?.contest?.end_date) }}
                  </ion-card-subtitle>
                </ion-card-header>
                <ion-card-content>
                  <ion-list>
                    <ion-item color="dark">
                      <ion-grid>
                        <ion-row>
                          <ion-col size="3">Categoría</ion-col>
                          <ion-col size="3">Sección</ion-col>
                          <ion-col size="2">Miniatura</ion-col>
                          <ion-col size="2">Obra</ion-col>
                          <ion-col size="2">Métrica</ion-col>
                        </ion-row>
                      </ion-grid>
                    </ion-item>
                    <ng-container *ngFor="let r of sortResults(it?.results)">
                      <ion-item *ngFor="let img of sortImages(r.images)">
                        <ion-grid>
                          <ion-row class="ion-align-items-center">
                            <ion-col size="3">{{ r.category }}</ion-col>
                            <ion-col size="3">{{ r.section }}</ion-col>
                            <ion-col size="2">
                              <img [src]="img?.thumbnail_url ? configService.imageUrl(img.thumbnail_url) : ''" alt="" style="height:48px;width:auto;border-radius:4px;" />
                            </ion-col>
                            <ion-col size="2" class="cap">{{ img.title }}</ion-col>
                            <ion-col size="2">
                              <ion-badge>{{ img.metric?.prize }}</ion-badge>
                              <span class="ion-margin-start">{{ img.metric?.score }}</span>
                            </ion-col>
                          </ion-row>
                        </ion-grid>
                      </ion-item>
                    </ng-container>
                  </ion-list>
                </ion-card-content>
              </ion-card>

              <ion-card class="ion-margin-top ion-margin-bottom">
                <ion-card-header>
                  <ion-card-title>Ranking</ion-card-title>
                </ion-card-header>
                <ion-card-content>
                  <ion-row>
                    <ion-col size="6">
                      <b>Puntaje total:</b>
                      <span class="ion-margin-start">{{ it?.ranking?.total_score }}</span>
                    </ion-col>
                    <ion-col size="6">
                      <b>Posición:</b>
                      <span class="ion-margin-start">{{ it?.ranking?.position }}</span>
                    </ion-col>
                  </ion-row>
                </ion-card-content>
              </ion-card>
            </ng-container>
          </ng-template>
          
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</div>